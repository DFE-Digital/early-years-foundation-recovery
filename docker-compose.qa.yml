# https://github.com/SeleniumHQ/docker-selenium
---
services:
  app:
    # uses self-signed certificates which need to be generated
    command: rails server -b 'ssl://0.0.0.0:3000?key=localhost.key&cert=localhost.crt'
    environment:
      - DATABASE_URL=postgres://postgres:password@db:5432/early_years_foundation_recovery_production
      - RAILS_SERVE_STATIC_FILES=true
    ports:
      - 3000:3000
    volumes:
      - .:/src

  qa:
    container_name: recovery_qa
    build:
      context: .
      target: qa
    image: recovery:qa
    environment:
      - BROWSER
      - BASE_URL
      # - BROWSER=firefox
      # - BASE_URL=https://evening-thicket-25194.herokuapp.com:443
      # - BASE_URL=https://app:3000
    depends_on:
      - app
      - chrome
      - firefox
    networks:
      - recovery

  chrome:
    container_name: recovery_chrome
    image: selenium/standalone-chrome:latest
    networks:
      - recovery

  firefox:
    container_name: recovery_firefox
    image: selenium/standalone-firefox:latest
    networks:
      - recovery
